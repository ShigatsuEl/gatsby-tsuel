---
title: NestJS + React를 사용한 Mafia 게임을 만들어 보자
date: 2021-07-15
slug: /blog/project/mafia/plan
categories: ['all', 'project']
tags: ['NestJS', 'TypeScript', 'WebSocket', 'React']
---

![Technology Stack](./project-mafia-plan-01.png 'Technology Stack')

최근에 NestJS를 프로젝트에서 사용한 경험이 있는데 타입스크립트 기반으로 코드를 작성할 수 있었기 때문에 
굉장히 안정적으로 프로젝트를 빌드할 수 있어 좋은 경험을 얻어갈 수 있었습니다.

그러던 와중,

>NestJS의 안정적인 구조에 더해 웹 소켓(WebSocket)을 추가해 재미있는 프로젝트를 만들어 볼 수 있지 않을까?

라는 생각을 하게 되었고, 여러가지 즐거운 상상을 하다가 최종적으로 마피아 게임을 만들어보기로 결정했습니다.

## 프로젝트 목적

코로나19 발발로 인해 사회적 거리두기가 오랫동안 지속되면서 너무 장기간동안 혼자 있게 되는 상황이 많아졌다고 생각이 듭니다.

하지만 사람은 본래 혼자서 살아가기보다 집단을 이루어 무언가를 계속해서 생산하고 추구하는 생물이기 때문에 현재 이러한 상황 속에서도 
누군가와 함께 어떤 것을 해나갈 수 있는 매개체가 필요하다고 생각했습니다.

따라서 저는 누군지도 모르는 사람일지라도 함께할 수 있는 방법과 여기에 즐거움을 줄 수 있는 요소를 추가한 엔터테인먼트를 만들어 보고 싶다는 
생각을 하게 된 것 같습니다.

이로 인해 생각하게 된 프로젝트의 주제가 마피아 게임이 되었고 조금이나마 사람들에게 즐거운 추억을 줄 수 있기를 바라며 기획하게 되었습니다.

## 프로젝트 대상

- 코로나19로 인해 집에서 오랫동안 머물러 혼자있기 심심한 분들

- 코로나19로 인해 친구들을 자주 만나지 못해 심심하신 분들

- 여럿이 노는 것을 좋아하나 사람을 만나는 것을 꺼려하시는 분들

- 어렸을 시절, 친구들과 마피아 게임을 해봤던 추억을 느끼고 싶은 분들

## 프로젝트 핵심 기능

- 웹 소켓을 사용한 실시간 채팅 구현

- 실시간 투표를 통한 게임 진행

- 게임 결과 발표를 하며 종료

## 인포메이션 아키텍처

- Logout Router

  - Home

    이메일 & 패스워드를 통한 로그인 인증 구현

    소셜 로그인 추가

  - Sign Up

    이메일 & 성 & 이름 & 비밀번호 & 비밀번호 체크 입력으로 회원가입 구현

    User 모델(eamil, firstName, lastName, password, passwordCheck)

- Login Router

  - Home

    실시간으로 게임 룸 인원 수, 상태, 멤버이름 업데이트 하기

    게임 룸에 인원이 아무도 없을 시, 방 삭제

    게임 룸 리스트 나열해서 보여주기(인원 수 정렬)

    Game 모델(title, currentHeadCount, totalHeadCount, status, gamerList: User 모델)

    - Profile

      이메일 & 성 & 이름 & 비밀번호 보여주기

      - Edit Profile

        패스워드 확인 후 성 & 이름 & 비밀번호 변경 가능

  - Game

    게임이 시작되면 인원수에 맞게 랜덤으로 직업(마피아 | 경찰 | 의사 | 시민)을 나누기 -> User 모델(+role)

    역할에 따라 룰을 달리 설명

    - 밤

      마피아만 채팅 활성화 & 채팅 볼 수 있음(15초) -> Chat 모델(userName: User 모델, content, visible)

      마피아 투표 -> Game 모델(+aliveUserList: [User 모델]) / 살아남은 시민과 마피아를 aliveUserList에 반영

      Case 1. 의사가 방어할 경우 -> 마피아로부터 보호

      Case 2. 경찰이 마피아를 지목한 경우 -> 알림창 설정

    - 낮

      30초 동안 실시간 채팅 활성화

      투표 활성화 -> Game 모델(+votedUser: User 모델) / 한명 당 한명만 투표할 수 있음

      낮 종료 시, 가장 많은 투표를 받은 용의자 선정 -> Game 모델(+suspect: User 모델)

    - 저녁

      용의자 발언(15초) -> 마피아, 시민은 발언권 없음

      용의자 발언 중 실시간 채팅 통제 | 발언 종료 후 채팅 10초간 활성화

      모든 게이머 투표 -> Game 모델 aliveUserList 반영

      Case 1. 마피아일 경우 마지막 마피아인지 확인하고 시민 승리로 게임 종료

      Case 2. 시민일 경우 다시 밤으로 넘어감

      저녁 종료 시, votedUser 초기화 & suspect null 초기화

    마피아 승리 또는 시민 승리 그리고 게임 진행 불가인 경우 게임 결과 발표를 하면서 종료

    방에 인원이 아무도 없으면 Game 데이터 삭제

## 와이어프레임

- Logout Router

  ![Logout Router](./project-mafia-plan-02.png 'Logout Router')

  로그아웃 상태에서는 회원가입과 로그인 인증을 구현합니다.

- Home

  ![Home](./project-mafia-plan-03.png 'Home')

  로그인 상태의 홈 화면은 게임 룸 리스트를 보여주며 Profile 링크를 구현합니다.

  Profile 화면에서는 Edit Profile을 구현합니다.

- Game

  ![Game Room](./project-mafia-plan-04.png 'Game Room')

  밤 | 낮 | 저녁의 패턴으로 이루어지며 각각 상황에 맞는 레이아웃을 구현합니다.

  밤에는 마피아를 위한 셋업, 낮에는 모든 유저의 실시간 채팅, 저녁에는 투표 공간을 마련합니다.

  ![Game Result](./project-mafia-plan-05.png 'Game Result')

  마피아가 먼저 잡히거나 시민이 모두 죽으면 게임이 종료되며 게임이 불가능한 상황에서도 종료할 수 있도록 합니다.

처음에는 6명을 토탈인원을 기준으로 구성하고 시간이 남게되면 4명, 8명까지 추가로 빌드할 생각입니다.

또한 마피아 프로젝트를 빌드하면서 경험한 방법과 재밌었던 부분에 대해서 모두 공유해볼 예정입니다.

시작해보겠습니다 :)