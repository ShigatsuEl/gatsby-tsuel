---
title: NestJS Database 연동하기(TypeORM, + MySQL)
date: 2021-07-25
slug: /blog/project/mafia/database
categories: ['all', 'project']
tags: ['NestJS', 'TypeScript', 'TypeORM', 'MySQL']
---

마피아 게임을 만들기 앞서 가장 필요한 것은 역시 데이터베이스를 연동하는 것 입니다. 
따라서 이번 글에서는 NestJS에서 어떻게 Database를 연동할 것인지 알아볼 것이며, 또한 프로젝트 빌드를 위해 필요한 갖가지 설정들도 다뤄볼 예정입니다.

## NestJS Project Start

가장 먼저 `@nest/cli` 패키지가 글로벌하게 설치가 되어 있는지 확인할 필요가 있습니다.

```shell{outputLines: 2-4}
npm list -g
C:\Users\User\AppData\Roaming\npm
├── ...
├── @nestjs/cli@7.6.0
```

설치가 되어 있지 않다면 다음 명령어로 글로벌하게 설치하도록 합시다.

```shell
npm install -g @nest/cli
```

설치를 마친 후 이제 우리는 NestJS 프로젝트를 생성하도록 합시다.

```shell
cd 자신이 프로젝트를 빌드하길 원하는 경로로 이동
nest new [프로젝트 이름]
```

nest은(는) 내부 또는 외부 명령 실행할 수 있는 프로그램 또는 배치 파일이 아닙니다. 
라는 메시지가 명령 프롬프트에 출력된다면 @nest/cli가 제대로 설치되어 있는지 확인하시길 바랍니다.

프로젝트 생성에 성공하면 에디터에서 프로젝트를 실행해보도록 할까요?

```shell
// npm으로 프로젝트 실행
npm run start:dev
// yarn으로 프로젝트 실행
yarn run start:dev
```

[서버](http://localhost:3000 'NestJS Server')로 이동하여 `Hello World!` 문구를 발견하셨다면 성공적으로 NestJS를 실행시킨 것 입니다.

## Path Alias

Database 연동을 시작하기 앞서 프로젝트에 필요한 몇가지 설정을 하려고 합니다. 
그 중 하나는 바로 `Path Alias`라는 것으로 우리가 어떠한 파일을 import할 때 어떠한 경로를 통해 가져올 것인지를 정하는 것 입니다. 
VSCode를 사용하고 있다면 default값으로 `relative path`를 사용하고 있을 확률이 높습니다. 
이것은 파일을 import하게 될 때 상대적인 위치에 따라 경로를 작성하는 방법으로 :point_right: `../../example/example.ts`와 같은 경로 작성을 사용해 import하는 방식을 뜻합니다. 

이번 프로젝트에서 저는 상대 경로로 작성하지 않고 절대 경로를 사용할 계획입니다. 
그 이유는 다음과 같습니다.

- 프로젝트가 커짐에 따라 `../../..`와 같은 경로 작성이 길어지게 되면서 가독성이 좋지 않다.

- 파일의 위치를 옮기게 되면 경로 작성을 처음부터 다시해야 한다. 만약 절대경로를 사용하게 된다면 파일을 옮기게 되어도 아무 문제가 발생하지 않는다.

NestJS에서 Path Alias를 지정하는 방법은 생각보다 어렵지 않습니다. 

1. TypeScript Path 지정

  NestJS에서는 TypeScript를 사용하기 때문에 TypeScript Configuration을 수정해줘야 합니다. 

  `tsconfig.json`
  ```json
  {
    "compilerOptions": {
      ...
    },
    // highlight-next-line
    "extends": "./tsconfig.paths.json"
  }
  ```

  `tsconfig.paths.json` 생성
  ```json
  {
    "compilerOptions": {
      "baseUrl": ".",
      "paths": {
        "@/*": ["src/*"]
      }
    }
  }
  ```

  `"@/*": ["src/*"]`는 src디렉토리의 모든 하위 디렉토리 내의 파일을 import 할 때 `@/`으로 import하도록 설정하겠다는 의미를 뜻합니다.

2. VSCode TypeScript importModuleSpecifier

  `.vscode` 디렉토리 :point_right: `settings.json` 파일 생성
  ```
  {
    "typescript.preferences.importModuleSpecifier": "non-relative"
  }
  ```

  위 설정은 현재 여러분이 만들 프로젝트 내에서만 절대 경로로 임포트할 수 있게 VSCode를 설정하는 방법입니다. 
  이제 프로젝트에서 `src`디렉토리 내에 있는 파일을 import하여 테스트 해보시길 바랍니다.

  ```ts
  import { AppModule } from '@/app.module';
  ```

  VSCode가 import를 도와줄 때마다 자동으로 @/으로 경로지정을 설정할 것 입니다. 

한가지 주의해야 할 점은 TypeScript Path 지정을 할 때 순서대로 작동한다는 것 입니다. 
예를들어 다음과 같이 Path Alias를 지정해보록 합시다.

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@users/*": ["src/users/*"]
    }
  }
}
```

이러한 경우에는 users 디렉토리 내의 파일을 import할 때 `@users/..`로 시작하는 경로로 지정하고 싶지만 
실제로 import를 하게 되면 `@/users/..`으로 import 하게 된다는 것 입니다. 
설정을 적용할 때 위에서부터 순서가 적용되므로 우리가 원하는 방법으로 import 하기를 원한다면 다음과 같이 순서를 바꿔줘야 합니다.

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@users/*": ["src/users/*"],
      "@/*": ["src/*"]
    }
  }
}
```

이제 `@users/*`가 우선적으로 Path 지정이 될 것 입니다. :blush: